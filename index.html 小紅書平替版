<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <title>å°å£è¢‹ - XHS é¢¨æ ¼å¯ç”¨ Demoï¼ˆå‰ç«¯æœ¬æ©Ÿç‰ˆï¼‰</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <style>
    :root{
      --bg:#0b0c10;
      --panel:#121318;
      --panel2:#161821;
      --text:#e5e7eb;
      --muted:#9ca3af;
      --muted2:#6b7280;
      --line:rgba(255,255,255,.08);
      --accent:#ff2d55;
      --accent2:#ff3b30;
      --chip:#1a1c26;
      --shadow: 0 18px 55px rgba(0,0,0,.45);
      --ok:#22c55e;
      --warn:#f59e0b;
    }
    *{box-sizing:border-box;-webkit-tap-highlight-color:transparent;}
    body{
      margin:0;
      font-family:-apple-system,BlinkMacSystemFont,"SF Pro Text","Segoe UI","Microsoft JhengHei",sans-serif;
      background: radial-gradient(circle at top, rgba(255,45,85,.12), transparent 40%), var(--bg);
      color:var(--text);
    }
    a{color:inherit;text-decoration:none;}
    img{max-width:100%;display:block;}
    button, input, textarea{font-family:inherit;}

    .shell{
      max-width: 460px;
      margin: 0 auto;
      min-height: 100vh;
      background: linear-gradient(180deg, rgba(255,255,255,.03), transparent 18%), var(--bg);
      border-left:1px solid var(--line);
      border-right:1px solid var(--line);
      display:flex;
      flex-direction:column;
    }

    /* Topbar */
    .topbar{
      position: sticky;
      top: 0;
      z-index: 50;
      padding: 10px 12px 8px;
      background: rgba(11,12,16,.86);
      backdrop-filter: blur(14px);
      border-bottom:1px solid var(--line);
    }
    .topbar-row{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .left-icon,.right-icon{
      width:28px;height:28px;
      border-radius:10px;
      display:flex;align-items:center;justify-content:center;
      background: rgba(255,255,255,.06);
      border:1px solid var(--line);
      font-size:15px;
      user-select:none;
    }
    .right-icon{cursor:pointer;}
    .main-tabs{
      flex:1;
      display:flex;
      align-items:center;
      justify-content:center;
      gap:18px;
      font-size:16px;
      letter-spacing:.5px;
    }
    .main-tab{
      position:relative;
      color:var(--muted);
      padding:6px 4px;
      cursor:pointer;
      user-select:none;
    }
    .main-tab.active{
      color:var(--text);
      font-weight:800;
    }
    .main-tab.active::after{
      content:"";
      position:absolute;
      left:20%;
      right:20%;
      bottom:2px;
      height:3px;
      border-radius:999px;
      background:var(--accent);
    }
    .subtabs{
      margin-top:8px;
      display:flex;
      align-items:center;
      gap:14px;
      overflow-x:auto;
      padding-bottom:2px;
      scrollbar-width:none;
    }
    .subtabs::-webkit-scrollbar{display:none;}
    .subtab{
      white-space:nowrap;
      font-size:13px;
      color:var(--muted2);
      padding:6px 2px;
      cursor:pointer;
      user-select:none;
    }
    .subtab.active{color:var(--text);font-weight:800;}
    .subtab.more{
      margin-left:auto;
      color:var(--muted);
      background: rgba(255,255,255,.06);
      border:1px solid var(--line);
      border-radius:999px;
      padding:4px 10px;
      font-size:12px;
      cursor:default;
    }

    /* Main */
    .main{
      flex:1;
      overflow:auto;
      padding: 10px 10px 76px;
    }

    /* Masonry 2-col */
    .masonry{
      column-count: 2;
      column-gap: 10px;
    }
    .card{
      break-inside: avoid;
      background: rgba(255,255,255,.04);
      border:1px solid var(--line);
      border-radius: 14px;
      overflow:hidden;
      margin: 0 0 10px;
      box-shadow: 0 8px 30px rgba(0,0,0,.18);
      cursor:pointer;
    }
    .thumb{
      width:100%;
      position:relative;
      overflow:hidden;
      background:#0f172a;
    }
    .thumb img{
      width:100%;
      height:auto;
      display:block;
      filter: contrast(1.02) saturate(1.02);
    }
    .thumb-badge{
      position:absolute;
      top:10px; right:10px;
      display:flex; align-items:center; gap:6px;
      font-size:11px;
      color:rgba(255,255,255,.92);
      background: rgba(0,0,0,.36);
      border:1px solid rgba(255,255,255,.12);
      padding:4px 8px;
      border-radius:999px;
      user-select:none;
    }
    .card-body{
      padding: 8px 10px 10px;
    }
    .card-title{
      font-size:13px;
      line-height:1.25;
      font-weight:700;
      margin: 0 0 8px;
      display:-webkit-box;
      -webkit-line-clamp:2;
      -webkit-box-orient:vertical;
      overflow:hidden;
    }
    .card-footer{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:8px;
      color:var(--muted2);
      font-size:12px;
    }
    .author{
      display:flex; align-items:center; gap:7px;
      min-width:0;
    }
    .ava{
      width:18px;height:18px;border-radius:50%;
      background: linear-gradient(135deg, #ff2d55, #ff9500);
      display:flex; align-items:center; justify-content:center;
      color:#fff;
      font-size:11px;
      flex:0 0 auto;
      user-select:none;
    }
    .author-name{
      overflow:hidden;text-overflow:ellipsis;white-space:nowrap;
      max-width: 130px;
      color: rgba(229,231,235,.92);
    }
    .like{
      display:flex; align-items:center; gap:5px;
      flex:0 0 auto;
      user-select:none;
    }
    .like .heart{cursor:pointer;}
    .like .heart.liked{color: var(--accent);}

    /* Market */
    .market-topsearch{
      display:flex;
      align-items:center;
      gap:10px;
      padding: 4px 0 10px;
    }
    .search-pill{
      flex:1;
      display:flex;
      align-items:center;
      gap:8px;
      padding: 10px 12px;
      border-radius:999px;
      background: rgba(255,255,255,.06);
      border:1px solid var(--line);
      color: var(--muted);
      font-size:13px;
    }
    .search-pill input{
      background:transparent;border:none;outline:none;color:var(--text);
      width:100%;
      font-size:13px;
    }
    .search-btn{
      padding:10px 12px;
      border-radius:999px;
      background: rgba(255,45,85,.16);
      border:1px solid rgba(255,45,85,.35);
      color: #ffd1dc;
      font-weight:750;
      font-size:13px;
      cursor:pointer;
      user-select:none;
    }
    .quick-icons{
      display:flex;
      justify-content:space-between;
      gap:10px;
      padding: 6px 2px 12px;
      overflow-x:auto;
      scrollbar-width:none;
    }
    .quick-icons::-webkit-scrollbar{display:none;}
    .qicon{
      min-width: 74px;
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:8px;
      padding: 8px 8px 10px;
      border-radius:16px;
      background: rgba(255,255,255,.04);
      border:1px solid var(--line);
    }
    .qicon .bubble{
      width:44px;height:44px;border-radius:16px;
      display:flex;align-items:center;justify-content:center;
      background: radial-gradient(circle at top, rgba(255,45,85,.25), rgba(255,255,255,.06));
      border:1px solid rgba(255,255,255,.10);
      font-size:18px;
      user-select:none;
    }
    .qicon span{
      font-size:11px;
      color: var(--muted);
      white-space:nowrap;
    }

    /* Bottom bar */
    .bottombar{
      position: sticky;
      bottom: 0;
      z-index: 60;
      height: 60px;
      background: rgba(11,12,16,.92);
      backdrop-filter: blur(14px);
      border-top:1px solid var(--line);
      display:flex;
      align-items:center;
      justify-content:space-around;
      padding: 6px 8px;
    }
    .btab{
      flex:1;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      gap:2px;
      color: var(--muted2);
      font-size:11px;
      cursor:pointer;
      user-select:none;
    }
    .btab .ico{font-size:18px;line-height:1;}
    .btab.active{color: var(--text);}
    .plus-wrap{
      width: 66px;
      display:flex;align-items:center;justify-content:center;
    }
    .plus-btn{
      width: 54px;height: 36px;
      border-radius: 12px;
      background: var(--accent);
      color:#fff;
      display:flex;align-items:center;justify-content:center;
      font-size:24px;
      font-weight:900;
      box-shadow: 0 12px 30px rgba(255,45,85,.25);
      border: 1px solid rgba(255,255,255,.10);
      cursor:pointer;
      user-select:none;
    }

    /* Plus action sheet */
    .overlay{
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,.55);
      display:none;
      z-index: 90;
    }
    .sheet{
      position: fixed;
      left: 0; right: 0; bottom: 0;
      max-width:460px;
      margin: 0 auto;
      background: rgba(18,19,24,.96);
      border-top:1px solid var(--line);
      border-radius: 18px 18px 0 0;
      padding: 10px 12px 14px;
      transform: translateY(30px);
      opacity: 0;
      transition: all .18s ease;
      z-index: 95;
      display:none;
    }
    .sheet.show{
      transform: translateY(0);
      opacity: 1;
    }
    .sheet-title{
      text-align:center;
      font-size:14px;
      color: var(--muted);
      padding: 10px 0 8px;
    }
    .sheet-btn{
      width:100%;
      border-radius: 14px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.04);
      padding: 14px 12px;
      font-size:16px;
      color: var(--text);
      text-align:center;
      margin: 10px 0;
      cursor:pointer;
      user-select:none;
    }
    .sheet-btn small{
      display:block;
      color: var(--muted2);
      font-size:12px;
      margin-top:4px;
    }
    .sheet-cancel{
      width:100%;
      border-radius: 14px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.02);
      padding: 14px 12px;
      font-size:16px;
      color: var(--muted);
      text-align:center;
      margin-top: 10px;
      cursor:pointer;
      user-select:none;
    }

    /* Views */
    .view{display:none;}
    .view.active{display:block;}

    /* Profile */
    .profile-hero{
      position:relative;
      border-radius: 16px;
      overflow:hidden;
      background: radial-gradient(circle at top left, rgba(255,45,85,.22), transparent 45%),
                  radial-gradient(circle at bottom right, rgba(59,130,246,.18), transparent 45%),
                  rgba(255,255,255,.03);
      border:1px solid var(--line);
      padding: 14px 12px;
    }
    .p-top{
      display:flex;
      align-items:center;
      justify-content:space-between;
      margin-bottom: 10px;
    }
    .p-name{
      font-size:20px;
      font-weight:900;
      letter-spacing:.2px;
    }
    .p-id{
      font-size:11px;
      color: var(--muted2);
      margin-top: 4px;
    }
    .p-actions{
      display:flex;
      gap:8px;
      align-items:center;
    }
    .pill{
      padding: 10px 12px;
      border-radius: 999px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.04);
      font-size:13px;
      color: var(--text);
      cursor:pointer;
      user-select:none;
    }
    .gear{
      width:40px;height:40px;border-radius:999px;
      display:flex;align-items:center;justify-content:center;
      border:1px solid var(--line);
      background: rgba(255,255,255,.04);
      cursor:pointer;
      user-select:none;
    }
    .p-ava-wrap{
      display:flex;
      align-items:center;
      gap:12px;
      margin-bottom: 10px;
    }
    .p-ava{
      width:64px;height:64px;border-radius:22px;
      background: rgba(255,255,255,.05);
      border:1px solid rgba(255,255,255,.10);
      position:relative;
      display:flex;align-items:center;justify-content:center;
      font-size:22px;
      color: rgba(255,255,255,.85);
      user-select:none;
      cursor:pointer;
      overflow:hidden;
    }
    .p-ava img{width:100%;height:100%;object-fit:cover;}
    .p-ava .plusdot{
      position:absolute;
      right:-6px; bottom:-6px;
      width:26px;height:26px;border-radius:999px;
      background: #ffd60a;
      color:#111827;
      display:flex;align-items:center;justify-content:center;
      font-weight:900;
      border:2px solid rgba(11,12,16,.9);
    }
    .p-bio{
      color: var(--muted);
      font-size:13px;
      margin: 6px 0 10px;
    }
    .p-stats{
      display:flex;
      gap:18px;
      font-size:12px;
      color: var(--muted2);
      margin-top: 6px;
    }
    .p-stats strong{
      color: var(--text);
      font-size:14px;
      margin-right:4px;
    }
    .profile-tabs{
      display:flex;
      gap:18px;
      align-items:center;
      margin-top: 12px;
      padding: 8px 2px 6px;
      border-bottom:1px solid var(--line);
      overflow-x:auto;
      scrollbar-width:none;
    }
    .profile-tabs::-webkit-scrollbar{display:none;}
    .ptab{
      font-size:13px;
      color: var(--muted2);
      padding: 6px 2px;
      cursor:pointer;
      white-space:nowrap;
      user-select:none;
    }
    .ptab.active{
      color: var(--text);
      font-weight:900;
      position:relative;
    }
    .ptab.active::after{
      content:"";
      position:absolute;
      left:0; right:0; bottom:-7px;
      height:3px;border-radius:999px;
      background: var(--accent);
      opacity:.9;
    }

    /* Modal: post detail */
    .modal{
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,.58);
      display:none;
      z-index: 200;
      padding: 14px;
    }
    .modal-card{
      max-width: 460px;
      margin: 0 auto;
      border-radius: 16px;
      background: rgba(18,19,24,.98);
      border:1px solid rgba(255,255,255,.10);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .modal-head{
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding: 12px 12px;
      border-bottom:1px solid var(--line);
    }
    .modal-title{
      font-weight:900;
      letter-spacing:.2px;
    }
    .modal-close{
      width:34px;height:34px;border-radius:12px;
      display:flex;align-items:center;justify-content:center;
      background: rgba(255,255,255,.06);
      border:1px solid var(--line);
      cursor:pointer;
      user-select:none;
    }
    .modal-body{
      padding: 12px 12px 14px;
    }
    .detail-gallery{
      border-radius: 14px;
      overflow:hidden;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
    }
    .detail-gallery img{
      width:100%;
      height: 340px;
      object-fit: cover;
    }
    .detail-dots{
      display:flex;gap:6px;justify-content:center;align-items:center;
      padding: 8px 0 10px;
      background: rgba(0,0,0,.25);
    }
    .dot{
      width:6px;height:6px;border-radius:999px;
      background: rgba(229,231,235,.35);
    }
    .dot.active{width:16px;background: rgba(229,231,235,.9);}
    .detail-text{
      margin-top: 10px;
      color: rgba(229,231,235,.92);
      line-height: 1.55;
      font-size: 14px;
      white-space: pre-wrap;
    }
    .chips{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      margin-top: 10px;
    }
    .chip{
      font-size: 12px;
      padding: 6px 10px;
      border-radius: 999px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
      color: rgba(229,231,235,.9);
    }
    .detail-actions{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      margin-top: 12px;
      padding-top: 10px;
      border-top:1px solid var(--line);
      color: var(--muted);
      font-size: 13px;
    }
    .detail-actions .btn{
      padding: 10px 12px;
      border-radius: 999px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.04);
      color: rgba(229,231,235,.95);
      cursor:pointer;
      user-select:none;
      font-weight:800;
      font-size: 13px;
    }
    .detail-actions .btn.primary{
      background: rgba(255,45,85,.18);
      border-color: rgba(255,45,85,.35);
      color: #ffd1dc;
    }

    /* Editor (å¯¦è£ç™¼ä½ˆ) */
    .editor{
      position: fixed;
      inset: 0;
      background: #07070a;
      z-index: 120;
      display:none;
      flex-direction:column;
    }
    .editor-top{
      height: 56px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding: 0 14px;
      border-bottom:1px solid var(--line);
      background: rgba(7,7,10,.9);
      backdrop-filter: blur(12px);
    }
    .eback{
      font-size:22px;
      color: var(--text);
      cursor:pointer;
      user-select:none;
    }
    .editor-top-mid{
      display:flex;
      gap:10px;
      align-items:center;
      color: var(--muted);
      font-size:12px;
    }
    .music-pill{
      padding: 8px 12px;
      border-radius: 999px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.04);
      color: var(--text);
      font-weight:750;
      user-select:none;
    }
    .editor-stage{
      flex:1;
      display:flex;
      align-items:center;
      justify-content:center;
      padding: 12px;
      position:relative;
    }
    .stage-img{
      width: 92%;
      max-width: 420px;
      border-radius: 12px;
      overflow:hidden;
      border:1px solid rgba(255,255,255,.12);
      box-shadow: var(--shadow);
      position:relative;
      background: rgba(255,255,255,.04);
    }
    .stage-img img{
      width:100%;
      height: 420px;
      object-fit: cover;
      display:block;
      filter: contrast(1.03) saturate(1.02);
    }
    .stage-empty{
      height: 420px;
      display:flex;
      align-items:center;
      justify-content:center;
      color: var(--muted);
      font-size: 14px;
      padding: 20px;
      text-align:center;
      line-height:1.5;
    }
    .stage-caption{
      position:absolute;
      left:10px; top:10px;
      padding: 8px 10px;
      border-radius: 12px;
      background: rgba(0,0,0,.35);
      border:1px solid rgba(255,255,255,.12);
      color: rgba(255,255,255,.92);
      font-size: 12px;
      max-width: 90%;
      line-height: 1.35;
      display:none;
      white-space: pre-wrap;
    }
    .stage-caption.show{display:block;}
    .stage-bottom-strip{
      position:absolute;
      left:0; right:0; bottom: 86px;
      padding: 0 14px;
      display:flex;
      gap:10px;
      align-items:center;
      justify-content:flex-start;
      overflow-x:auto;
      scrollbar-width:none;
    }
    .stage-bottom-strip::-webkit-scrollbar{display:none;}
    .thumbmini{
      width: 58px; height: 58px;
      border-radius: 12px;
      border:2px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      overflow:hidden;
      flex:0 0 auto;
      position:relative;
      cursor:pointer;
    }
    .thumbmini.active{border-color: rgba(255,45,85,.9);}
    .thumbmini img{width:100%;height:100%;object-fit:cover;}
    .thumbmini.add{
      display:flex;align-items:center;justify-content:center;
      font-size: 26px;
      color: rgba(255,255,255,.9);
      user-select:none;
    }
    .editor-tools{
      height: 86px;
      border-top:1px solid var(--line);
      background: rgba(7,7,10,.92);
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding: 10px 14px;
      gap:10px;
    }
    .toolrow{
      display:flex;
      align-items:center;
      gap:16px;
      color: var(--muted);
      font-size:11px;
      overflow-x:auto;
      scrollbar-width:none;
    }
    .toolrow::-webkit-scrollbar{display:none;}
    .tool{
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:6px;
      cursor:pointer;
      user-select:none;
      min-width: 44px;
    }
    .tool .ticon{font-size:18px;color:rgba(255,255,255,.86);}
    .next-btn{
      padding: 12px 16px;
      border-radius: 999px;
      background: var(--accent);
      color:#fff;
      font-weight:950;
      border:none;
      cursor:pointer;
      user-select:none;
      white-space:nowrap;
    }

    /* Post detail step */
    .composer{
      position: fixed;
      inset: 0;
      background: rgba(7,7,10,.98);
      z-index: 140;
      display:none;
      flex-direction:column;
    }
    .composer-top{
      height: 56px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding: 0 14px;
      border-bottom:1px solid var(--line);
      background: rgba(7,7,10,.92);
      backdrop-filter: blur(12px);
    }
    .ctitle{
      font-weight:900;
      letter-spacing:.2px;
    }
    .cbody{
      flex:1;
      overflow:auto;
      padding: 12px 14px 16px;
    }
    .form{
      border-radius: 16px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
      padding: 12px;
    }
    .fg{margin-bottom: 10px;}
    .lbl{font-size:12px;color:var(--muted);margin-bottom:6px;}
    .inp,.ta{
      width:100%;
      border-radius: 12px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.22);
      color: rgba(229,231,235,.95);
      padding: 10px 10px;
      outline:none;
      font-size: 14px;
    }
    .ta{min-height: 110px; resize: vertical;}
    .help{font-size:11px;color:var(--muted2);margin-top:6px;line-height:1.4;}
    .cactions{
      display:flex;
      gap:10px;
      margin-top: 10px;
    }
    .cbtn{
      flex:1;
      border-radius: 999px;
      padding: 12px 10px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.04);
      color: rgba(229,231,235,.95);
      font-weight:900;
      cursor:pointer;
      user-select:none;
    }
    .cbtn.primary{
      background: rgba(255,45,85,.18);
      border-color: rgba(255,45,85,.35);
      color: #ffd1dc;
    }
    .mini-preview{
      margin-top: 10px;
      border-radius: 14px;
      overflow:hidden;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
    }
    .mini-preview img{width:100%;height:240px;object-fit:cover;}
    .toast{
      position: fixed;
      left: 50%;
      transform: translateX(-50%);
      bottom: 78px;
      background: rgba(17,24,39,.92);
      border:1px solid rgba(255,255,255,.12);
      color: rgba(229,231,235,.95);
      padding: 10px 12px;
      border-radius: 999px;
      font-size: 13px;
      display:none;
      z-index: 250;
      box-shadow: 0 14px 40px rgba(0,0,0,.55);
    }
    .toast.show{display:block;}

    /* Search drawer */
    .search-drawer{
      position: fixed;
      left:0; right:0; top:0; bottom:0;
      display:none;
      z-index: 160;
      background: rgba(0,0,0,.62);
      padding: 14px;
    }
    .search-card{
      max-width: 460px;
      margin: 0 auto;
      border-radius: 16px;
      background: rgba(18,19,24,.98);
      border:1px solid rgba(255,255,255,.10);
      overflow:hidden;
      box-shadow: var(--shadow);
    }
    .search-head{
      padding: 12px 12px;
      border-bottom:1px solid var(--line);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .search-head .title{font-weight:900;}
    .search-body{padding: 12px;}
    .sbar{
      display:flex;gap:10px;align-items:center;
      border-radius: 999px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.22);
      padding: 10px 12px;
      color: var(--muted);
      font-size: 13px;
    }
    .sbar input{
      background: transparent;
      border: none;
      outline: none;
      color: rgba(229,231,235,.95);
      width: 100%;
      font-size: 13px;
    }
    .hotchips{
      display:flex;flex-wrap:wrap;gap:8px;
      margin-top: 12px;
    }
    .hotchip{
      padding: 8px 10px;
      border-radius: 999px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
      color: rgba(229,231,235,.9);
      font-size: 12px;
      cursor:pointer;
      user-select:none;
    }

    @media (min-width: 768px){
      .shell{
        margin: 16px auto;
        border-radius: 22px;
        overflow:hidden;
        box-shadow: var(--shadow);
      }
      .bottombar{border-radius: 0 0 22px 22px;}
    }
  </style>
</head>
<body>
  <div class="shell">

    <header class="topbar" id="topbar">
      <div class="topbar-row">
        <div class="left-icon" title="ç¦®ç‰©">ğŸ</div>
        <div class="main-tabs">
          <div class="main-tab" data-main="follow">è¿½è¹¤ä¸­</div>
          <div class="main-tab active" data-main="discover">ç™¼ç¾</div>
          <div class="main-tab" data-main="nearby">é™„è¿‘</div>
        </div>
        <div class="right-icon" id="openSearch" title="æœå°‹">ğŸ”</div>
      </div>
      <div class="subtabs" id="subtabs">
        <div class="subtab active" data-cat="æ¨è–¦">æ¨è–¦</div>
        <div class="subtab" data-cat="å½±ç‰‡">å½±ç‰‡</div>
        <div class="subtab" data-cat="ç›´æ’­">ç›´æ’­</div>
        <div class="subtab" data-cat="çŸ­åŠ‡">çŸ­åŠ‡</div>
        <div class="subtab" data-cat="ç¾é£Ÿ">ç¾é£Ÿ</div>
        <div class="subtab" data-cat="ç©¿æ­">ç©¿æ­</div>
        <div class="subtab more">â–¾</div>
      </div>
    </header>

    <main class="main">
      <section id="view-home" class="view active">
        <div id="homeTip" style="margin:2px 2px 10px;color:var(--muted);font-size:12px;line-height:1.4;">
          é€™æ˜¯å¯ç”¨ Demoï¼šä½ å¯ä»¥ç”¨ã€Œï¼‹ã€é¸ç›¸ç°¿ä¸Šå‚³ã€å¯«æ–‡å­—ã€ç™¼ä½ˆã€‚<br/>
          æ‰€æœ‰è²¼æ–‡æœƒå„²å­˜åœ¨ <b>localStorage</b>ï¼ˆåŒä¸€å°è£ç½®ã€åŒä¸€ç€è¦½å™¨å¯ä¿ç•™ï¼‰ã€‚
        </div>
        <div class="masonry" id="home-masonry"></div>
      </section>

      <section id="view-market" class="view">
        <div class="market-topsearch">
          <div class="search-pill">
            ğŸ” <input id="marketSearch" placeholder="æœå°‹å•†å“â€¦" value="æ³¡æ³¡ç‘ªç‰¹æ–°å“" aria-label="search" />
          </div>
          <div class="search-btn">æœå°‹</div>
        </div>
        <div class="quick-icons">
          <div class="qicon"><div class="bubble">ğŸ“º</div><span>ç›´æ’­å»£å ´</span></div>
          <div class="qicon"><div class="bubble">ğŸŒŸ</div><span>æ˜Ÿå…‰å¤œå¸‚</span></div>
          <div class="qicon"><div class="bubble">ğŸ›ï¸</div><span>ç¾å¦™å•†åº—</span></div>
          <div class="qicon"><div class="bubble">ğŸ’¸</div><span>è¶…ç´šæ»¿æ¸›</span></div>
          <div class="qicon"><div class="bubble">ğŸ§¾</div><span>æ¸…å–®</span></div>
        </div>
        <div class="masonry" id="market-masonry"></div>
      </section>

      <section id="view-msg" class="view">
        <div class="card" style="padding:14px;cursor:default;">
          <div style="font-weight:900;margin-bottom:6px;">è¨Šæ¯</div>
          <div style="color:var(--muted);font-size:13px;line-height:1.5;">
            é€™é å…ˆåšå¤–è§€ï¼Œæœªæ¥å¾Œç«¯ã€‚<br/>
            ä½ è¦å¯¦è£ï¼š1å°1 ç§è¨Šã€é€šçŸ¥ä¸­å¿ƒã€ç³»çµ±æ¨æ’­ï¼Œæˆ‘å¯ä»¥å†å¹«ä½ æ‹† API çµæ§‹ã€‚
          </div>
        </div>
      </section>

      <section id="view-me" class="view">
        <div class="profile-hero">
          <div class="p-top">
            <div style="display:flex;align-items:center;gap:10px;">
              <div style="font-size:18px;opacity:.9;user-select:none;">â˜°</div>
              <div>
                <div class="p-name" id="profileName">Demo ä½¿ç”¨è€…</div>
                <div class="p-id" id="profileId">å°å£è¢‹è™Ÿï¼š49713818333</div>
              </div>
            </div>
            <div class="p-actions">
              <div class="pill" id="editProfileBtn">ç·¨è¼¯è³‡æ–™</div>
              <div class="gear" title="è¨­å®š">âš™ï¸</div>
            </div>
          </div>

          <div class="p-ava-wrap">
            <div class="p-ava" id="avatarBox" title="ä¸Šå‚³é ­åƒ">
              <span id="avatarFallback">ğŸ“·</span>
              <img id="avatarImg" alt="avatar" style="display:none;"/>
              <div class="plusdot">+</div>
            </div>
            <div style="flex:1;min-width:0;">
              <div class="p-bio" id="profileBio">æš«æ™‚é‚„æ²’æœ‰ä»‹ç´¹</div>
              <div class="p-stats">
                <div><strong id="statFollow">0</strong>è¿½è¹¤ä¸­</div>
                <div><strong id="statFans">0</strong>ç²‰çµ²</div>
                <div><strong id="statLikes">0</strong>ç²è®šèˆ‡æ”¶è—</div>
              </div>
            </div>
          </div>
        </div>

        <div class="profile-tabs">
          <div class="ptab active" data-ptab="notes">ç­†è¨˜</div>
          <div class="ptab" data-ptab="fav">æ”¶è—</div>
          <div class="ptab" data-ptab="liked">ğŸ”’ è´Šé</div>
          <div class="ptab" style="margin-left:auto;opacity:.9;cursor:default;">ğŸ”</div>
        </div>

        <div id="myEmpty" style="padding: 14px 6px 8px;color:var(--muted);font-size:13px;text-align:center;">
          ç™¼ä½ˆä½ çš„ç¬¬ä¸€ç¯‡ç­†è¨˜
        </div>
        <div class="masonry" id="my-masonry"></div>
      </section>
    </main>

    <nav class="bottombar">
      <div class="btab active" data-view="home"><div class="ico">ğŸ </div><div>é¦–é </div></div>
      <div class="btab" data-view="market"><div class="ico">ğŸ¬</div><div>å¸‚é›†</div></div>
      <div class="plus-wrap"><div class="plus-btn" id="plusBtn">ï¼‹</div></div>
      <div class="btab" data-view="msg"><div class="ico">ğŸ’¬</div><div>è¨Šæ¯</div></div>
      <div class="btab" data-view="me"><div class="ico">ğŸ‘¤</div><div>æˆ‘</div></div>
    </nav>
  </div>

  <!-- Plus Sheet -->
  <div class="overlay" id="overlay"></div>
  <div class="sheet" id="sheet">
    <div class="sheet-title">å¾ç›¸ç°¿é¸æ“‡</div>
    <div class="sheet-btn" id="btnAlbum">ç›¸ç°¿<small>é¸æ“‡ç…§ç‰‡ / å¤šå¼µ</small></div>
    <div class="sheet-btn" id="btnWrite">å¯«æ–‡å­—<small>ç´”æ–‡å­—ç­†è¨˜</small></div>
    <div class="sheet-cancel" id="btnCancel">å–æ¶ˆ</div>
  </div>

  <!-- Hidden file inputs -->
  <input id="albumInput" type="file" accept="image/*" multiple style="display:none;" />
  <input id="avatarInput" type="file" accept="image/*" style="display:none;" />

  <!-- Editor (media step) -->
  <div class="editor" id="editor">
    <div class="editor-top">
      <div class="eback" id="editorBack">â€¹</div>
      <div class="editor-top-mid">
        <div class="music-pill">â™« é¸æ“‡éŸ³æ¨‚</div>
      </div>
      <div style="opacity:.85;font-size:18px;user-select:none;">â‹¯</div>
    </div>

    <div class="editor-stage">
      <div class="stage-img">
        <div class="stage-empty" id="stageEmpty">
          ç›®å‰æ²’æœ‰é¸æ“‡åœ–ç‰‡ã€‚<br/>è«‹é»ä¸‹æ–¹ã€Œï¼‹ã€æ–°å¢åœ–ç‰‡ï¼Œæˆ–è¿”å›ç”¨ã€Œç›¸ç°¿ã€ä¸€æ¬¡é¸å¤šå¼µã€‚
        </div>
        <img id="stageImage" alt="stage" style="display:none;"/>
        <div class="stage-caption" id="stageCaption"></div>
      </div>

      <div class="stage-bottom-strip" id="thumbStrip">
        <div class="thumbmini add" id="addMoreThumb">ï¼‹</div>
      </div>
    </div>

    <div class="editor-tools">
      <div class="toolrow">
        <div class="tool" data-tool="filter"><div class="ticon">âœ¨</div><div>æ¿¾é¡</div></div>
        <div class="tool" data-tool="text"><div class="ticon">T</div><div>æ–‡å­—</div></div>
        <div class="tool" data-tool="tag"><div class="ticon">ğŸ·ï¸</div><div>æ¨™è¨˜</div></div>
        <div class="tool" data-tool="sticker"><div class="ticon">ğŸ§©</div><div>è²¼åœ–</div></div>
        <div class="tool" data-tool="crop"><div class="ticon">âœ‚ï¸</div><div>è£åˆ‡</div></div>
        <div class="tool" data-tool="more"><div class="ticon">â‹¯</div><div>æ›´å¤š</div></div>
      </div>
      <button class="next-btn" id="nextToCompose">ä¸‹ä¸€æ­¥</button>
    </div>
  </div>

  <!-- Composer (detail step) -->
  <div class="composer" id="composer">
    <div class="composer-top">
      <div class="eback" id="composeBack">â€¹</div>
      <div class="ctitle">ç™¼ä½ˆç­†è¨˜</div>
      <div style="width:22px;"></div>
    </div>
    <div class="cbody">
      <div class="form">
        <div class="fg">
          <div class="lbl">æ¨™é¡Œ</div>
          <input class="inp" id="cTitle" placeholder="å¯«å€‹å¸å¼•äººçš„æ¨™é¡Œâ€¦" maxlength="40"/>
          <div class="help">å»ºè­° 10ï½30 å­—ï¼Œåƒå°ç´…æ›¸ç­†è¨˜ä¸€æ¨£æ¸…æ¥šç›´æ¥ã€‚</div>
        </div>
        <div class="fg">
          <div class="lbl">å…§å®¹</div>
          <textarea class="ta" id="cContent" placeholder="åˆ†äº«ä½ çš„å¿ƒå¾—ã€åšæ³•ã€æ¸…å–®æˆ–æ•…äº‹â€¦"></textarea>
        </div>
        <div class="fg">
          <div class="lbl">æ¨™ç±¤ï¼ˆç”¨é€—è™Ÿåˆ†éš”ï¼‰</div>
          <input class="inp" id="cTags" placeholder="ä¾‹å¦‚ï¼šç¾é£Ÿ, ç©¿æ­, æ—…éŠ" />
          <div class="help">æ¨™ç±¤æœƒç”¨æ–¼åˆ†é¡èˆ‡æœå°‹ï¼Œå»ºè­° 1ï½5 å€‹ã€‚</div>
        </div>

        <div class="mini-preview" id="miniPreview" style="display:none;">
          <img id="miniPreviewImg" alt="preview"/>
        </div>

        <div class="cactions">
          <button class="cbtn" id="saveDraftBtn">å­˜æˆè‰ç¨¿</button>
          <button class="cbtn primary" id="publishBtn">ç™¼ä½ˆ</button>
        </div>
        <div class="help" style="margin-top:10px;">
          ã€Œè‰ç¨¿ã€å’Œã€Œè²¼æ–‡ã€éƒ½æœƒå­˜åœ¨æœ¬æ©Ÿ localStorageã€‚è‹¥ä½ æ¸…é™¤ç€è¦½å™¨è³‡æ–™ï¼Œå…§å®¹æœƒæ¶ˆå¤±ã€‚
        </div>
      </div>
    </div>
  </div>

  <!-- Post Detail Modal -->
  <div class="modal" id="detailModal">
    <div class="modal-card">
      <div class="modal-head">
        <div style="display:flex;align-items:center;gap:8px;min-width:0;">
          <div class="ava" id="dAva">å£</div>
          <div style="min-width:0;">
            <div class="modal-title" id="dUser">å°å£è¢‹ç”¨æˆ¶</div>
            <div style="font-size:11px;color:var(--muted2);" id="dTime">å‰›å‰›</div>
          </div>
        </div>
        <div class="modal-close" id="detailClose">âœ•</div>
      </div>
      <div class="modal-body">
        <div class="detail-gallery" id="dGallery">
          <img id="dImg" alt="detail"/>
          <div class="detail-dots" id="dDots"></div>
        </div>
        <div style="margin-top:10px;font-size:16px;font-weight:900;" id="dTitle"></div>
        <div class="detail-text" id="dContent"></div>
        <div class="chips" id="dTags"></div>
        <div class="detail-actions">
          <div style="display:flex;gap:10px;align-items:center;">
            <div class="btn" id="dLikeBtn">â¤ï¸ <span id="dLikeCount">0</span></div>
            <div class="btn">ğŸ’¬ ç•™è¨€</div>
          </div>
          <div style="display:flex;gap:10px;align-items:center;">
            <div class="btn">â˜† æ”¶è—</div>
            <div class="btn primary">åˆ†äº«</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Search Drawer -->
  <div class="search-drawer" id="searchDrawer">
    <div class="search-card">
      <div class="search-head">
        <div class="title">æœå°‹</div>
        <div class="modal-close" id="searchClose">âœ•</div>
      </div>
      <div class="search-body">
        <div class="sbar">
          ğŸ” <input id="searchInput" placeholder="æœå°‹æ¨™é¡Œã€å…§å®¹ã€æ¨™ç±¤â€¦" />
        </div>
        <div class="hotchips">
          <div class="hotchip" data-q="ç¾é£Ÿ"># ç¾é£Ÿ</div>
          <div class="hotchip" data-q="ç©¿æ­"># ç©¿æ­</div>
          <div class="hotchip" data-q="æ—…éŠ"># æ—…éŠ</div>
          <div class="hotchip" data-q="3C"># 3C</div>
          <div class="hotchip" data-q="ç”Ÿæ´»"># ç”Ÿæ´»</div>
        </div>
        <div style="margin-top:12px;color:var(--muted2);font-size:12px;line-height:1.4;">
          é€™è£¡æœƒç›´æ¥ç¯©é¸é¦–é ç€‘å¸ƒæµå…§å®¹ï¼ˆæœ¬æ©Ÿè³‡æ–™ï¼‰ã€‚
        </div>
      </div>
    </div>
  </div>

  <div class="toast" id="toast"></div>

<script>
  /***********************
   * Storage helpers
   ***********************/
  const STORAGE_KEY = "xiaopocket_posts_v1";
  const DRAFT_KEY = "xiaopocket_drafts_v1";
  const PROFILE_KEY = "xiaopocket_profile_v1";

  function safeJsonParse(s, fallback){
    try { return JSON.parse(s); } catch(e){ return fallback; }
  }
  function loadPosts(){
    const saved = safeJsonParse(localStorage.getItem(STORAGE_KEY), null);
    if(Array.isArray(saved)) return saved;
    return [];
  }
  function savePosts(posts){
    localStorage.setItem(STORAGE_KEY, JSON.stringify(posts));
  }
  function loadDrafts(){
    const saved = safeJsonParse(localStorage.getItem(DRAFT_KEY), null);
    if(Array.isArray(saved)) return saved;
    return [];
  }
  function saveDrafts(drafts){
    localStorage.setItem(DRAFT_KEY, JSON.stringify(drafts));
  }
  function loadProfile(){
    const saved = safeJsonParse(localStorage.getItem(PROFILE_KEY), null);
    if(saved && typeof saved === "object") return saved;
    return { name: "Demo ä½¿ç”¨è€…", bio: "æš«æ™‚é‚„æ²’æœ‰ä»‹ç´¹", avatar: null, id: "49713818333" };
  }
  function saveProfile(p){
    localStorage.setItem(PROFILE_KEY, JSON.stringify(p));
  }

  /***********************
   * Seed demo posts (once)
   ***********************/
  function seedIfEmpty(){
    const existing = loadPosts();
    if(existing.length) return;

    const demo = [
      {
        id: "demo-1",
        user: "æµ·é‚Šæ•£æ­¥çš„äºº",
        avatarChar: "æµ·",
        title: "é€±æœ«ä¸€å€‹äººå»æµ·é‚Šæ•£æ•£å¿ƒ",
        content: "æ²’æœ‰ç‰¹åˆ¥çš„å®‰æ’ï¼Œå°±å¸¶è‘—è€³æ©Ÿã€ç›¸æ©Ÿå’Œä¸€æœ¬æ›¸ï¼Œæ²¿è‘—æµ·é‚Šæ…¢æ…¢èµ°ã€‚æ”¾ç©ºä¹Ÿæ˜¯å¾ˆé‡è¦çš„è¡Œç¨‹ã€‚",
        tags: ["æ—…éŠ","ç”Ÿæ´»","å¿ƒæƒ…"],
        cat: "æ¨è–¦",
        images: ["https://images.pexels.com/photos/2404370/pexels-photo-2404370.jpeg?auto=compress&cs=tinysrgb&w=900"],
        likes: 23,
        liked: false,
        time: "2 å°æ™‚å‰"
      },
      {
        id: "demo-2",
        user: "ä¸‹ç­æƒ³èººè‘—",
        avatarChar: "ç­",
        title: "æ‡¶äººä¹Ÿèƒ½åšçš„è¶…ç°¡å–®ä¸€é‹æ–™ç†",
        content: "è”¬èœã€è‡é¡ã€é›è‚‰å…¨éƒ¨ä¸Ÿé€²é‹è£¡ï¼Œèª¿å‘³å¾Œä¸€èµ·ç…®ã€‚æ´—ç¢—ä¹Ÿåªè¦æ´—ä¸€é‹ã€‚",
        tags: ["ç¾é£Ÿ","æ‡¶äººæ–™ç†"],
        cat: "ç¾é£Ÿ",
        images: [
          "https://images.pexels.com/photos/5718025/pexels-photo-5718025.jpeg?auto=compress&cs=tinysrgb&w=900",
          "https://images.pexels.com/photos/5718023/pexels-photo-5718023.jpeg?auto=compress&cs=tinysrgb&w=900",
          "https://images.pexels.com/photos/5717994/pexels-photo-5717994.jpeg?auto=compress&cs=tinysrgb&w=900"
        ],
        likes: 41,
        liked: false,
        time: "æ˜¨å¤©"
      },
      {
        id: "demo-3",
        user: "è¡—å£ç©¿æ­æ§",
        avatarChar: "æ­",
        title: "ä»Šå¤©è©¦è‘—æ›äº†ä¸€ç¨®é¡è‰²çš„ç©¿æ­",
        content: "ä¸€ç›´éƒ½å¾ˆå®³æ€•ç©¿äº®è‰²ï¼Œä½†ä»Šå¤©ç¡¬è‘—é ­çš®è²·äº†ä¸€ä»¶äº®æ©˜è‰²å¤–å¥—ã€‚æ„å¤–çš„å¥½çœ‹ï¼Œèµ°åœ¨è·¯ä¸Šå¿ƒæƒ…éƒ½è®Šå¥½äº†ã€‚",
        tags: ["ç©¿æ­","ç”Ÿæ´»"],
        cat: "ç©¿æ­",
        images: [
          "https://images.pexels.com/photos/7671166/pexels-photo-7671166.jpeg?auto=compress&cs=tinysrgb&w=900",
          "https://images.pexels.com/photos/7671168/pexels-photo-7671168.jpeg?auto=compress&cs=tinysrgb&w=900"
        ],
        likes: 67,
        liked: false,
        time: "3 å¤©å‰"
      }
    ];
    savePosts(demo);
  }

  /***********************
   * App state
   ***********************/
  seedIfEmpty();
  let profile = loadProfile();
  let posts = loadPosts();      // includes demo + user posts
  let drafts = loadDrafts();

  let currentView = "home";
  let currentMainTab = "discover";
  let currentCat = "æ¨è–¦";
  let searchQuery = "";

  // compose/editor
  let editorImages = [];    // dataURLs
  let editorIndex = 0;
  let editorOverlayText = "";
  let composingFrom = "album"; // album|text
  let composingDraftId = null;

  // detail modal
  let detailPost = null;
  let detailImgIndex = 0;

  /***********************
   * DOM
   ***********************/
  const views = {
    home: document.getElementById("view-home"),
    market: document.getElementById("view-market"),
    msg: document.getElementById("view-msg"),
    me: document.getElementById("view-me"),
  };
  const topbar = document.getElementById("topbar");
  const btabs = Array.from(document.querySelectorAll(".btab"));

  const homeMasonry = document.getElementById("home-masonry");
  const myMasonry = document.getElementById("my-masonry");
  const myEmpty = document.getElementById("myEmpty");

  const plusBtn = document.getElementById("plusBtn");
  const overlay = document.getElementById("overlay");
  const sheet = document.getElementById("sheet");
  const btnCancel = document.getElementById("btnCancel");
  const btnAlbum = document.getElementById("btnAlbum");
  const btnWrite = document.getElementById("btnWrite");
  const albumInput = document.getElementById("albumInput");

  const editor = document.getElementById("editor");
  const editorBack = document.getElementById("editorBack");
  const stageEmpty = document.getElementById("stageEmpty");
  const stageImage = document.getElementById("stageImage");
  const stageCaption = document.getElementById("stageCaption");
  const thumbStrip = document.getElementById("thumbStrip");
  const addMoreThumb = document.getElementById("addMoreThumb");
  const nextToCompose = document.getElementById("nextToCompose");

  const composer = document.getElementById("composer");
  const composeBack = document.getElementById("composeBack");
  const cTitle = document.getElementById("cTitle");
  const cContent = document.getElementById("cContent");
  const cTags = document.getElementById("cTags");
  const miniPreview = document.getElementById("miniPreview");
  const miniPreviewImg = document.getElementById("miniPreviewImg");
  const saveDraftBtn = document.getElementById("saveDraftBtn");
  const publishBtn = document.getElementById("publishBtn");

  const detailModal = document.getElementById("detailModal");
  const detailClose = document.getElementById("detailClose");
  const dAva = document.getElementById("dAva");
  const dUser = document.getElementById("dUser");
  const dTime = document.getElementById("dTime");
  const dGallery = document.getElementById("dGallery");
  const dImg = document.getElementById("dImg");
  const dDots = document.getElementById("dDots");
  const dTitle = document.getElementById("dTitle");
  const dContent = document.getElementById("dContent");
  const dTags = document.getElementById("dTags");
  const dLikeBtn = document.getElementById("dLikeBtn");
  const dLikeCount = document.getElementById("dLikeCount");

  const toast = document.getElementById("toast");

  const profileName = document.getElementById("profileName");
  const profileId = document.getElementById("profileId");
  const profileBio = document.getElementById("profileBio");
  const avatarBox = document.getElementById("avatarBox");
  const avatarFallback = document.getElementById("avatarFallback");
  const avatarImg = document.getElementById("avatarImg");
  const avatarInput = document.getElementById("avatarInput");
  const editProfileBtn = document.getElementById("editProfileBtn");
  const statFollow = document.getElementById("statFollow");
  const statFans = document.getElementById("statFans");
  const statLikes = document.getElementById("statLikes");

  const openSearch = document.getElementById("openSearch");
  const searchDrawer = document.getElementById("searchDrawer");
  const searchClose = document.getElementById("searchClose");
  const searchInput = document.getElementById("searchInput");

  /***********************
   * UI helpers
   ***********************/
  function showToast(msg){
    toast.textContent = msg;
    toast.classList.add("show");
    setTimeout(()=> toast.classList.remove("show"), 1600);
  }

  function escapeHtml(str){
    return String(str||"")
      .replaceAll("&","&amp;")
      .replaceAll("<","&lt;")
      .replaceAll(">","&gt;");
  }

  function nowLabel(){
    return "å‰›å‰›";
  }

  function genId(prefix){
    return prefix + "-" + Date.now() + "-" + Math.floor(Math.random()*10000);
  }

  function getAvatarChar(name){
    const s = (name||"å£").trim();
    return s ? s.slice(0,1) : "å£";
  }

  /***********************
   * Rendering: cards
   ***********************/
  function cardHeightHint(images){
    // make masonry feel varied
    if(!images || !images.length) return 190;
    const n = images.length;
    if(n === 1) return 240;
    if(n === 2) return 210;
    if(n >= 3) return 190;
    return 220;
  }

  function createCard(post){
    const card = document.createElement("div");
    card.className = "card";
    card.dataset.postId = post.id;

    const firstImg = post.images && post.images.length ? post.images[0] : null;
    const badge = (post.images && post.images.length > 1) ? "ğŸ“· ç›¸ç°¿" : (firstImg ? "" : "âœ æ–‡å­—");
    const h = cardHeightHint(post.images);

    const safeTitle = escapeHtml(post.title || "æœªå‘½å");
    const safeUser = escapeHtml(post.user || "å°å£è¢‹ç”¨æˆ¶");
    const avaChar = escapeHtml(post.avatarChar || getAvatarChar(post.user || "å£"));
    const likes = Number(post.likes || 0);

    card.innerHTML = `
      <div class="thumb" style="height:${firstImg ? "auto" : (h+"px")}">
        ${firstImg ? `<img src="${firstImg}" alt="thumb"/>` : `<div style="height:${h}px;display:flex;align-items:center;justify-content:center;color:var(--muted);padding:14px;text-align:center;line-height:1.5;">${escapeHtml((post.content||"").slice(0,70))}${(post.content||"").length>70?"â€¦":""}</div>`}
        ${badge ? `<div class="thumb-badge">${badge}</div>` : ""}
      </div>
      <div class="card-body">
        <div class="card-title">${safeTitle}</div>
        <div class="card-footer">
          <div class="author">
            <div class="ava">${avaChar}</div>
            <div class="author-name">${safeUser}</div>
          </div>
          <div class="like" data-like="1">
            <span class="heart ${post.liked ? "liked" : ""}">â™¡</span>
            <span class="count">${likes}</span>
          </div>
        </div>
      </div>
    `;

    // open detail
    card.addEventListener("click", (e)=>{
      // if clicking heart, handle like
      const likeWrap = e.target.closest(".like");
      if(likeWrap){
        e.stopPropagation();
        toggleLike(post.id);
        return;
      }
      openDetail(post.id);
    });

    return card;
  }

  function applyFilters(list){
    let out = list.slice();

    // search
    if(searchQuery){
      const q = searchQuery.toLowerCase();
      out = out.filter(p => {
        const text = (p.title + " " + p.content + " " + (p.tags||[]).join(" ")).toLowerCase();
        return text.includes(q);
      });
    }

    // category (only on home view)
    if(currentCat && currentCat !== "æ¨è–¦"){
      out = out.filter(p => (p.cat || "æ¨è–¦") === currentCat || (p.tags||[]).includes(currentCat));
    }

    // main tab demo: follow/nearby only visual; keep same.
    return out;
  }

  function renderHome(){
    posts = loadPosts(); // refresh from storage
    const filtered = applyFilters(posts).slice().reverse(); // newest first: reverse so demo seeded earlier appears lower
    // better: sort by createdAt if present
    filtered.sort((a,b)=> (b.createdAt||0) - (a.createdAt||0));

    homeMasonry.innerHTML = "";
    if(!filtered.length){
      const div = document.createElement("div");
      div.style.color = "var(--muted)";
      div.style.fontSize = "13px";
      div.style.padding = "10px 4px";
      div.textContent = "ç›®å‰æ²’æœ‰ç¬¦åˆæ¢ä»¶çš„å…§å®¹ã€‚";
      homeMasonry.appendChild(div);
      return;
    }
    filtered.forEach(p => homeMasonry.appendChild(createCard(p)));
  }

  function renderMy(){
    posts = loadPosts();
    const mine = posts
      .filter(p => p.isMine)
      .sort((a,b)=> (b.createdAt||0) - (a.createdAt||0));

    myMasonry.innerHTML = "";
    if(!mine.length){
      myEmpty.style.display = "block";
    } else {
      myEmpty.style.display = "none";
      mine.forEach(p => myMasonry.appendChild(createCard(p)));
    }

    // stats (demo numbers)
    const likesTotal = mine.reduce((acc,p)=> acc + (p.likes||0), 0);
    statLikes.textContent = String(likesTotal);
  }

  function renderMarket(){
    const marketMasonry = document.getElementById("market-masonry");
    if(marketMasonry.dataset.rendered) return;

    const items = [
      {title:"å·¨ä¿æš–90ç™½éµçµ¨çŸ­", promo:"æ»¿699æ¸›200 Â· 1.8è¬+äººåŠ è³¼", price:"Â¥499", sold:"å·²å”® 3378"},
      {title:"è“è“å…”å¯æ„›æ£‰æœèŒ", promo:"1ä»¶8.8æŠ˜ Â· æ™šç™¼å¿…è³ ", price:"Â¥278.01", sold:"å·²å”® 205"},
      {title:"å°çœ¾èƒŒåŒ…å¥—è£çµ„åˆ", promo:"æ–°å“ä¸Šæ¶ Â· é™æ™‚åˆ¸", price:"Â¥189", sold:"å·²å”® 512"},
      {title:"å±…å®¶ä¿æš–é€£å¸½å¤–å¥—", promo:"é ˜åˆ¸ç¾çœ Â· å…é‹", price:"Â¥159", sold:"å·²å”® 1024"},
      {title:"æ”¶ç´ç¥å™¨åˆ†éš”ç›’", promo:"ç¬¬äºŒä»¶åŠåƒ¹", price:"Â¥49", sold:"å·²å”® 2666"},
      {title:"è³ªæ„Ÿä¿æº«æ¯", promo:"åŠ è³¼åƒ¹ Â· å…é‹", price:"Â¥79", sold:"å·²å”® 1333"},
    ];

    function randomH(h1,h2){ return Math.floor(h1 + Math.random()*(h2-h1)); }
    function shopCardHtml(item){
      const h = randomH(190, 290);
      const img = "https://images.pexels.com/photos/7671166/pexels-photo-7671166.jpeg?auto=compress&cs=tinysrgb&w=900";
      return `
        <div class="card" style="cursor:default;">
          <div class="thumb" style="height:${h}px">
            <img src="${img}" alt="thumb" style="height:${h}px;object-fit:cover;opacity:.92"/>
            <div class="thumb-badge">å‹å¥½å¸‚é›†</div>
          </div>
          <div class="card-body">
            <div class="card-title">${escapeHtml(item.title)}</div>
            <div style="display:inline-flex;align-items:center;gap:6px;font-size:10px;color:#ffd1dc;background:rgba(255,45,85,.16);border:1px solid rgba(255,45,85,.30);padding:3px 8px;border-radius:999px;margin-top:6px;">
              ğŸŸï¸ ${escapeHtml(item.promo || "é ˜åˆ¸æ›´çœ")}
            </div>
            <div style="display:flex;align-items:baseline;justify-content:space-between;gap:10px;margin-top:6px;">
              <div style="color:#fff;font-weight:900;letter-spacing:.2px;"><small style="color:rgba(255,255,255,.75);font-weight:750;margin-right:2px;">åˆ¸å¾Œ</small>${escapeHtml(item.price)}</div>
              <div style="color:var(--muted2);font-size:11px;">${escapeHtml(item.sold)}</div>
            </div>
          </div>
        </div>
      `;
    }

    marketMasonry.innerHTML = items.map(shopCardHtml).join("");
    marketMasonry.dataset.rendered = "1";
  }

  /***********************
   * Navigation
   ***********************/
  function setView(name){
    currentView = name;
    Object.values(views).forEach(v => v.classList.remove("active"));
    (views[name] || views.home).classList.add("active");
    btabs.forEach(t => t.classList.toggle("active", t.dataset.view === name));

    // show topbar only on home
    topbar.style.display = (name === "home") ? "block" : "none";

    // reset scroll
    document.querySelector(".shell .main").scrollTop = 0;

    if(name === "home") renderHome();
    if(name === "me") renderMy();
    if(name === "market") renderMarket();
  }
  btabs.forEach(t => t.addEventListener("click", ()=> setView(t.dataset.view)));

  /***********************
   * Main tabs / sub tabs (filters)
   ***********************/
  document.querySelectorAll(".main-tab").forEach(tab => {
    tab.addEventListener("click", ()=>{
      document.querySelectorAll(".main-tab").forEach(x=>x.classList.remove("active"));
      tab.classList.add("active");
      currentMainTab = tab.dataset.main || "discover";
      // demo: keep same list, just toast
      showToast(currentMainTab === "follow" ? "è¿½è¹¤ä¸­ï¼ˆDemoï¼‰" : (currentMainTab === "nearby" ? "é™„è¿‘ï¼ˆDemoï¼‰" : "ç™¼ç¾"));
    });
  });

  document.querySelectorAll(".subtab").forEach(tab => {
    tab.addEventListener("click", ()=>{
      if(tab.classList.contains("more")) return;
      document.querySelectorAll(".subtab").forEach(x=>x.classList.remove("active"));
      tab.classList.add("active");
      currentCat = tab.dataset.cat || "æ¨è–¦";
      renderHome();
    });
  });

  /***********************
   * Search
   ***********************/
  function openSearchDrawer(){
    searchDrawer.style.display = "block";
    setTimeout(()=> searchInput.focus(), 50);
  }
  function closeSearchDrawer(){
    searchDrawer.style.display = "none";
  }
  openSearch.addEventListener("click", openSearchDrawer);
  searchClose.addEventListener("click", closeSearchDrawer);
  searchDrawer.addEventListener("click", (e)=>{
    if(e.target === searchDrawer) closeSearchDrawer();
  });
  searchInput.addEventListener("input", ()=>{
    searchQuery = (searchInput.value || "").trim();
    renderHome();
  });
  document.querySelectorAll(".hotchip").forEach(ch => {
    ch.addEventListener("click", ()=>{
      const q = ch.dataset.q || "";
      searchInput.value = q;
      searchQuery = q;
      renderHome();
      closeSearchDrawer();
      showToast("å·²å¥—ç”¨æœå°‹ï¼š" + q);
    });
  });

  /***********************
   * Plus sheet
   ***********************/
  function openSheet(){
    overlay.style.display = "block";
    sheet.style.display = "block";
    requestAnimationFrame(()=> sheet.classList.add("show"));
  }
  function closeSheet(){
    sheet.classList.remove("show");
    overlay.style.display = "none";
    setTimeout(()=> sheet.style.display="none", 120);
  }
  plusBtn.addEventListener("click", openSheet);
  overlay.addEventListener("click", closeSheet);
  btnCancel.addEventListener("click", closeSheet);

  btnAlbum.addEventListener("click", ()=>{
    composingFrom = "album";
    composingDraftId = null;
    closeSheet();
    // trigger file picker
    albumInput.value = "";
    albumInput.click();
  });

  btnWrite.addEventListener("click", ()=>{
    composingFrom = "text";
    composingDraftId = null;
    closeSheet();
    // open composer directly (no images)
    editorImages = [];
    editorIndex = 0;
    editorOverlayText = "";
    openComposerFromEditor(); // show compose with empty preview
  });

  albumInput.addEventListener("change", async (e)=>{
    const files = Array.from(e.target.files || []).slice(0, 9);
    if(!files.length) return;

    editorImages = [];
    editorIndex = 0;

    for(const file of files){
      const dataUrl = await fileToDataUrl(file);
      editorImages.push(dataUrl);
    }

    openEditor();
    renderEditor();
  });

  function fileToDataUrl(file){
    return new Promise((resolve,reject)=>{
      const reader = new FileReader();
      reader.onload = ()=> resolve(reader.result);
      reader.onerror = reject;
      reader.readAsDataURL(file);
    });
  }

  /***********************
   * Editor
   ***********************/
  function openEditor(){
    editor.style.display = "flex";
  }
  function closeEditor(){
    editor.style.display = "none";
  }
  editorBack.addEventListener("click", ()=>{
    closeEditor();
    editorImages = [];
    editorIndex = 0;
    editorOverlayText = "";
  });

  addMoreThumb.addEventListener("click", ()=>{
    // add more images (reuse album input)
    albumInput.value = "";
    albumInput.click();
  });

  // Tool interactions (å¯¦è£ä¸€å€‹ï¼šæ–‡å­—ç–ŠåŠ )
  document.querySelectorAll(".tool").forEach(t=>{
    t.addEventListener("click", ()=>{
      const tool = t.dataset.tool;
      if(tool === "text"){
        const txt = prompt("è¼¸å…¥è¦ç–ŠåŠ åœ¨åœ–ç‰‡ä¸Šçš„æ–‡å­—ï¼ˆDemoï¼šæœƒé¡¯ç¤ºåœ¨é è¦½åœ–å·¦ä¸Šè§’ï¼‰", editorOverlayText || "");
        if(txt !== null){
          editorOverlayText = (txt || "").trim();
          renderEditor();
        }
        return;
      }
      showToast("ã€Œ" + t.innerText.replace(/\s+/g,"") + "ã€ç‚º Demo å¤–è§€ï¼Œå¯å†æ“´å……ã€‚");
    });
  });

  function renderEditor(){
    // stage
    if(!editorImages.length){
      stageEmpty.style.display = "flex";
      stageImage.style.display = "none";
    } else {
      stageEmpty.style.display = "none";
      stageImage.style.display = "block";
      stageImage.src = editorImages[editorIndex];
    }

    // overlay text
    if(editorOverlayText){
      stageCaption.classList.add("show");
      stageCaption.textContent = editorOverlayText;
    } else {
      stageCaption.classList.remove("show");
      stageCaption.textContent = "";
    }

    // thumbs (remove old except add button)
    Array.from(thumbStrip.querySelectorAll(".thumbmini")).forEach(el=>{
      if(el !== addMoreThumb) el.remove();
    });
    // insert thumbs before addMoreThumb
    editorImages.forEach((src, idx)=>{
      const th = document.createElement("div");
      th.className = "thumbmini" + (idx===editorIndex ? " active" : "");
      const im = document.createElement("img");
      im.src = src;
      th.appendChild(im);
      th.addEventListener("click", ()=>{
        editorIndex = idx;
        renderEditor();
      });
      thumbStrip.insertBefore(th, addMoreThumb);
    });
  }

  nextToCompose.addEventListener("click", ()=>{
    if(composingFrom === "album" && !editorImages.length){
      showToast("è«‹å…ˆé¸æ“‡è‡³å°‘ 1 å¼µåœ–ç‰‡ã€‚");
      return;
    }
    openComposerFromEditor();
  });

  /***********************
   * Composer (publish)
   ***********************/
  function openComposerFromEditor(){
    closeEditor();
    composer.style.display = "flex";

    // preview
    if(editorImages.length){
      miniPreview.style.display = "block";
      miniPreviewImg.src = editorImages[0];
    } else {
      miniPreview.style.display = "none";
      miniPreviewImg.src = "";
    }

    // if draft loaded
    if(composingDraftId){
      const d = drafts.find(x=>x.id===composingDraftId);
      if(d){
        cTitle.value = d.title || "";
        cContent.value = d.content || "";
        cTags.value = (d.tags||[]).join(", ");
        return;
      }
    }

    // default suggestion
    if(!cTitle.value && !cContent.value){
      cTitle.value = "";
      cContent.value = "";
      cTags.value = "";
    }
  }

  function closeComposer(){
    composer.style.display = "none";
    composingDraftId = null;
    cTitle.value = "";
    cContent.value = "";
    cTags.value = "";
  }

  composeBack.addEventListener("click", ()=>{
    closeComposer();
    // reset compose state
    editorImages = [];
    editorIndex = 0;
    editorOverlayText = "";
  });

  saveDraftBtn.addEventListener("click", ()=>{
    const title = (cTitle.value || "").trim() || "æœªå‘½åè‰ç¨¿";
    const content = (cContent.value || "").trim();
    const tags = parseTags(cTags.value);

    const draft = {
      id: composingDraftId || genId("draft"),
      title, content, tags,
      images: editorImages.slice(),
      overlayText: editorOverlayText || "",
      createdAt: Date.now(),
      time: nowLabel()
    };

    if(composingDraftId){
      drafts = drafts.map(d => d.id===composingDraftId ? draft : d);
    } else {
      drafts.push(draft);
      composingDraftId = draft.id;
    }
    saveDrafts(drafts);
    showToast("å·²å­˜è‰ç¨¿ï¼ˆæœ¬æ©Ÿï¼‰");
  });

  function parseTags(raw){
    return String(raw || "")
      .split(",")
      .map(s=>s.trim())
      .filter(Boolean)
      .slice(0, 8);
  }

  publishBtn.addEventListener("click", ()=>{
    const title = (cTitle.value || "").trim();
    const content = (cContent.value || "").trim();
    const tags = parseTags(cTags.value);

    if(!title && !content && !editorImages.length){
      showToast("è‡³å°‘è¦æœ‰æ¨™é¡Œ/å…§å®¹/åœ–ç‰‡å…¶ä¸€ã€‚");
      return;
    }

    // category inference
    let cat = "æ¨è–¦";
    const knownCats = ["å½±ç‰‡","ç›´æ’­","çŸ­åŠ‡","ç¾é£Ÿ","ç©¿æ­"];
    for(const k of knownCats){
      if(tags.includes(k) || title.includes(k) || content.includes(k)){
        cat = k;
        break;
      }
    }

    const post = {
      id: genId("post"),
      user: profile.name || "Demo ä½¿ç”¨è€…",
      avatarChar: getAvatarChar(profile.name || "å£"),
      title: title || (editorImages.length ? "æœªå‘½åç­†è¨˜" : "æ–‡å­—ç­†è¨˜"),
      content: content,
      tags,
      cat,
      images: editorImages.slice(),
      overlayText: editorOverlayText || "",
      likes: 0,
      liked: false,
      time: nowLabel(),
      createdAt: Date.now(),
      isMine: true
    };

    posts = loadPosts();
    posts.push(post);
    savePosts(posts);

    // remove draft if publishing from a draft
    if(composingDraftId){
      drafts = loadDrafts().filter(d => d.id !== composingDraftId);
      saveDrafts(drafts);
    }

    closeComposer();
    editorImages = [];
    editorIndex = 0;
    editorOverlayText = "";

    showToast("å·²ç™¼ä½ˆï¼ˆæœ¬æ©Ÿï¼‰");
    setView("home");
  });

  /***********************
   * Like
   ***********************/
  function toggleLike(postId){
    const list = loadPosts();
    const idx = list.findIndex(p => p.id === postId);
    if(idx < 0) return;

    const p = list[idx];
    p.liked = !p.liked;
    p.likes = Math.max(0, (p.likes||0) + (p.liked ? 1 : -1));
    list[idx] = p;
    savePosts(list);

    // refresh UI
    if(detailPost && detailPost.id === postId){
      detailPost = p;
      renderDetail();
    }
    if(currentView === "home") renderHome();
    if(currentView === "me") renderMy();
  }

  /***********************
   * Detail modal
   ***********************/
  function openDetail(postId){
    const p = loadPosts().find(x=>x.id===postId);
    if(!p) return;
    detailPost = p;
    detailImgIndex = 0;
    renderDetail();
    detailModal.style.display = "block";
  }
  function closeDetail(){
    detailModal.style.display = "none";
    detailPost = null;
    detailImgIndex = 0;
  }
  detailClose.addEventListener("click", closeDetail);
  detailModal.addEventListener("click", (e)=>{
    if(e.target === detailModal) closeDetail();
  });

  function renderDetail(){
    const p = detailPost;
    if(!p) return;

    dAva.textContent = (p.avatarChar || getAvatarChar(p.user)).slice(0,1);
    dUser.textContent = p.user || "å°å£è¢‹ç”¨æˆ¶";
    dTime.textContent = p.time || "";

    dTitle.textContent = p.title || "";
    dContent.textContent = (p.content || "");

    // tags
    dTags.innerHTML = "";
    (p.tags || []).forEach(t => {
      const c = document.createElement("div");
      c.className = "chip";
      c.textContent = "#" + t;
      dTags.appendChild(c);
    });

    // gallery
    const imgs = (p.images || []);
    if(imgs.length){
      dGallery.style.display = "block";
      dImg.src = imgs[Math.min(detailImgIndex, imgs.length-1)];
      dDots.innerHTML = "";
      imgs.forEach((_,i)=>{
        const dot = document.createElement("div");
        dot.className = "dot" + (i===detailImgIndex ? " active" : "");
        dot.addEventListener("click", ()=>{
          detailImgIndex = i;
          renderDetail();
        });
        dDots.appendChild(dot);
      });
    } else {
      dGallery.style.display = "none";
    }

    dLikeCount.textContent = String(p.likes || 0);
    dLikeBtn.classList.toggle("primary", !!p.liked);
    dLikeBtn.innerHTML = `â¤ï¸ <span id="dLikeCount">${p.likes || 0}</span>`;
  }

  dLikeBtn.addEventListener("click", ()=>{
    if(!detailPost) return;
    toggleLike(detailPost.id);
  });

  /***********************
   * Profile editing + avatar
   ***********************/
  function renderProfile(){
    profileName.textContent = profile.name || "Demo ä½¿ç”¨è€…";
    profileId.textContent = "å°å£è¢‹è™Ÿï¼š" + (profile.id || "49713818333");
    profileBio.textContent = profile.bio || "æš«æ™‚é‚„æ²’æœ‰ä»‹ç´¹";

    if(profile.avatar){
      avatarFallback.style.display = "none";
      avatarImg.style.display = "block";
      avatarImg.src = profile.avatar;
    } else {
      avatarFallback.style.display = "block";
      avatarImg.style.display = "none";
      avatarImg.src = "";
    }
  }

  avatarBox.addEventListener("click", ()=>{
    avatarInput.value = "";
    avatarInput.click();
  });
  avatarInput.addEventListener("change", async (e)=>{
    const file = (e.target.files || [])[0];
    if(!file) return;
    const dataUrl = await fileToDataUrl(file);
    profile.avatar = dataUrl;
    saveProfile(profile);
    renderProfile();
    showToast("é ­åƒå·²æ›´æ–°ï¼ˆæœ¬æ©Ÿï¼‰");
  });

  editProfileBtn.addEventListener("click", ()=>{
    const name = prompt("æš±ç¨±", profile.name || "");
    if(name === null) return;
    const bio = prompt("å€‹äººç°¡ä»‹", profile.bio || "");
    if(bio === null) return;

    profile.name = (name || "").trim() || "Demo ä½¿ç”¨è€…";
    profile.bio = (bio || "").trim() || "æš«æ™‚é‚„æ²’æœ‰ä»‹ç´¹";
    saveProfile(profile);
    renderProfile();
    showToast("è³‡æ–™å·²æ›´æ–°ï¼ˆæœ¬æ©Ÿï¼‰");
  });

  /***********************
   * Boot
   ***********************/
  renderProfile();
  renderMarket();
  renderHome();

  // default view: home
  setView("home");
</script>
</body>
</html>
