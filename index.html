<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <title>å°å£è¢‹ XiaoPocket - Demo V1</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <style>
    * {
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "Segoe UI", "Microsoft JhengHei", sans-serif;
      background: #f3f4f6;
      color: #111827;
      font-size: 16px;
    }
    img {
      max-width: 100%;
      display: block;
    }
    button {
      font-family: inherit;
    }

    /* App å®¹å™¨ */
    .app-shell {
      max-width: 480px;
      margin: 0 auto;
      min-height: 100vh;
      background: #ffffff;
      display: flex;
      flex-direction: column;
      border-left: 1px solid #e5e7eb;
      border-right: 1px solid #e5e7eb;
    }

    /* é ‚éƒ¨åˆ— */
    .top-bar {
      position: sticky;
      top: 0;
      z-index: 20;
      height: 52px;
      padding: 0 16px;
      background: #ffffff;
      border-bottom: 1px solid #e5e7eb;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .top-title {
      font-weight: 700;
      font-size: 18px;
      letter-spacing: 2px;
    }
    .top-sub {
      font-size: 11px;
      color: #9ca3af;
    }
    .top-right {
      font-size: 13px;
      color: #6b7280;
    }

    /* å…§å®¹å€åŸŸ */
    .main {
      flex: 1;
      overflow-y: auto;
      background: #f3f4f6;
      padding-bottom: 56px;
    }

    .page {
      display: none;
      padding: 8px 12px 16px;
    }
    .page.active {
      display: block;
    }

    /* åº•éƒ¨å°èˆª */
    .tab-bar {
      position: sticky;
      bottom: 0;
      z-index: 20;
      display: flex;
      height: 56px;
      border-top: 1px solid #e5e7eb;
      background: #ffffff;
    }
    .tab-item {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      font-size: 11px;
      color: #6b7280;
      cursor: pointer;
      user-select: none;
    }
    .tab-item span.icon {
      font-size: 18px;
      margin-bottom: 2px;
    }
    .tab-item.active {
      color: #ef4444;
      font-weight: 600;
    }

    /* å…±ç”¨å¡ç‰‡ */
    .card {
      background: #ffffff;
      border-radius: 12px;
      padding: 10px;
      margin: 8px 0;
      box-shadow: 0 0 0 1px rgba(15,23,42,0.03);
    }

    /* é¦–é è²¼æ–‡å¡ç‰‡ */
    .post-header {
      display: flex;
      align-items: center;
      margin-bottom: 8px;
    }
    .avatar {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: linear-gradient(135deg, #f97316, #ef4444);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      color: #fff;
      font-size: 16px;
      margin-right: 8px;
      flex-shrink: 0;
    }
    .post-user {
      font-size: 13px;
      font-weight: 600;
    }
    .post-meta {
      font-size: 11px;
      color: #9ca3af;
    }
    .post-title {
      font-size: 15px;
      font-weight: 600;
      margin: 4px 0 6px;
    }
    .post-text {
      font-size: 13px;
      color: #4b5563;
      line-height: 1.5;
      margin-bottom: 8px;
    }
    .post-image {
      border-radius: 10px;
      overflow: hidden;
      margin-bottom: 8px;
      background: #e5e7eb;
    }
    .post-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-bottom: 6px;
    }
    .tag {
      font-size: 11px;
      padding: 2px 8px;
      border-radius: 999px;
      background: #fee2e2;
      color: #b91c1c;
    }
    .post-actions {
      display: flex;
      align-items: center;
      justify-content: space-between;
      font-size: 13px;
      color: #6b7280;
    }
    .post-actions-left,
    .post-actions-right {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    .icon-btn {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      cursor: pointer;
    }

    /* æ¢ç´¢é  */
    .search-bar {
      display: flex;
      align-items: center;
      padding: 8px 10px;
      border-radius: 999px;
      background: #f3f4f6;
      font-size: 13px;
      color: #9ca3af;
      margin-bottom: 10px;
    }
    .search-bar input {
      border: none;
      outline: none;
      background: transparent;
      font-size: 13px;
      flex: 1;
      padding-left: 6px;
    }
    .chip-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 10px;
    }
    .chip {
      font-size: 11px;
      padding: 4px 10px;
      border-radius: 999px;
      background: #fef2f2;
      color: #b91c1c;
      cursor: pointer;
    }
    .chip.hot {
      background: #fee2e2;
      font-weight: 600;
    }

    /* ç™¼æ–‡é  */
    .form-group {
      margin-bottom: 10px;
    }
    .form-label {
      font-size: 13px;
      margin-bottom: 4px;
      color: #374151;
      font-weight: 500;
    }
    .form-input,
    .form-textarea {
      width: 100%;
      padding: 8px 10px;
      border-radius: 10px;
      border: 1px solid #d1d5db;
      font-size: 14px;
      font-family: inherit;
      outline: none;
    }
    .form-input:focus,
    .form-textarea:focus {
      border-color: #ef4444;
      box-shadow: 0 0 0 1px rgba(239,68,68,0.15);
    }
    .form-textarea {
      min-height: 80px;
      resize: vertical;
    }
    .upload-box {
      border-radius: 10px;
      border: 1px dashed #d1d5db;
      padding: 10px;
      background: #f9fafb;
      text-align: center;
      font-size: 12px;
      color: #6b7280;
      cursor: pointer;
      position: relative;
    }
    .upload-box input {
      position: absolute;
      inset: 0;
      opacity: 0;
      cursor: pointer;
    }
    .upload-preview {
      margin-top: 8px;
      border-radius: 10px;
      overflow: hidden;
      display: none;
    }
    .btn-primary {
      width: 100%;
      border: none;
      border-radius: 999px;
      padding: 10px 0;
      font-size: 15px;
      font-weight: 600;
      background: linear-gradient(135deg, #f97316, #ef4444);
      color: #ffffff;
      cursor: pointer;
      margin-top: 6px;
    }
    .btn-primary:active {
      opacity: 0.9;
    }
    .helper-text {
      font-size: 11px;
      color: #9ca3af;
      margin-top: 4px;
    }

    /* å€‹äººé  */
    .profile-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 8px;
    }
    .profile-avatar {
      width: 52px;
      height: 52px;
      border-radius: 50%;
      background: linear-gradient(135deg, #f97316, #ef4444);
      display: flex;
      align-items: center;
      justify-content: center;
      color: #fff;
      font-size: 26px;
    }
    .profile-name {
      font-size: 16px;
      font-weight: 700;
    }
    .profile-meta {
      font-size: 12px;
      color: #6b7280;
    }
    .profile-stats {
      display: flex;
      gap: 18px;
      font-size: 12px;
      margin-top: 6px;
    }
    .stat-label {
      color: #9ca3af;
    }
    .stat-value {
      font-weight: 600;
      font-size: 13px;
    }
    .section-title {
      font-size: 13px;
      font-weight: 600;
      margin: 10px 0 4px;
    }
    .empty-hint {
      font-size: 12px;
      color: #9ca3af;
      padding: 10px 0;
      text-align: center;
    }

    /* å°æç¤ºæ¢ */
    .hint-banner {
      font-size: 11px;
      color: #6b7280;
      background: #fff7ed;
      border-radius: 10px;
      padding: 8px 10px;
      margin-bottom: 8px;
    }
    .hint-banner span {
      color: #f97316;
      font-weight: 600;
    }

    @media (min-width: 768px) {
      body {
        background: radial-gradient(circle at top, #fee2e2, #e5e7eb 45%, #f3f4f6);
      }
      .app-shell {
        margin-top: 16px;
        margin-bottom: 16px;
        border-radius: 20px;
        box-shadow: 0 18px 55px rgba(15,23,42,0.18);
      }
    }
  </style>
</head>
<body>
<div class="app-shell">
  <!-- Top Bar -->
  <header class="top-bar">
    <div>
      <div class="top-title">å°å£è¢‹</div>
      <div class="top-sub">XiaoPocket Demo</div>
    </div>
    <div class="top-right">Beta Â· å‰ç«¯å±•ç¤º</div>
  </header>

  <!-- Main -->
  <main class="main">
    <!-- é¦–é  -->
    <section id="page-home" class="page active">
      <div class="hint-banner">
        é€™æ˜¯ <span>å°å£è¢‹</span> çš„å‰ç«¯ Demoã€‚æ‰€æœ‰è²¼æ–‡éƒ½æš«å­˜æ–¼ç€è¦½å™¨ï¼Œä¸é€£ç·šå¾Œç«¯ã€ä¸åŒ…å«é›»å•†ï¼Œåªå±•ç¤ºåŸºæœ¬çš„å…§å®¹ç€è¦½èˆ‡ç™¼ä½ˆæµç¨‹ã€‚
      </div>

      <div id="feed-list"></div>
    </section>

    <!-- æ¢ç´¢ -->
    <section id="page-discover" class="page">
      <div class="search-bar">
        <span style="font-size:16px;">ğŸ”</span>
        <input id="search-input" placeholder="æœå°‹ç­†è¨˜ã€ä¸»é¡Œæˆ–æ¨™ç±¤â€¦" />
      </div>

      <div class="chip-row">
        <div class="chip hot" data-tag="ç¾é£Ÿ"># ç¾é£Ÿæ—¥å¸¸</div>
        <div class="chip" data-tag="æ—…éŠ"># é€±æœ«å°æ—…è¡Œ</div>
        <div class="chip" data-tag="ç©¿æ­"># ä»Šæ—¥ç©¿æ­</div>
        <div class="chip" data-tag="3C"># 3C é–‹ç®±</div>
        <div class="chip" data-tag="ç”Ÿæ´»"># ç”Ÿæ´»ç¢ç‰‡</div>
      </div>

      <div class="section-title">çŒœä½ æƒ³çœ‹</div>
      <div id="discover-list"></div>
    </section>

    <!-- ç™¼ä½ˆ -->
    <section id="page-post" class="page">
      <div class="card">
        <div class="form-group">
          <div class="form-label">æ¨™é¡Œ</div>
          <input id="post-title" class="form-input" placeholder="ä»Šå¤©çš„å°ç™¼ç¾â€¦" />
        </div>
        <div class="form-group">
          <div class="form-label">å…§å®¹</div>
          <textarea id="post-content" class="form-textarea" placeholder="åˆ†äº«ä½ çš„å¿ƒå¾—ã€æ•…äº‹æˆ–å°ç­†è¨˜â€¦"></textarea>
          <div class="helper-text">æ–‡å­—å°‡æœƒä»¥å¡ç‰‡æ–¹å¼é¡¯ç¤ºåœ¨é¦–é ï¼Œæ–¹ä¾¿å¿«é€Ÿåˆ·å…§å®¹ã€‚</div>
        </div>
        <div class="form-group">
          <div class="form-label">æ¨™ç±¤ï¼ˆä»¥é€—è™Ÿåˆ†éš”ï¼‰</div>
          <input id="post-tags" class="form-input" placeholder="ä¾‹å¦‚ï¼šç¾é£Ÿ, æ—…éŠ, ä»Šæ—¥ç©¿æ­" />
        </div>
        <div class="form-group">
          <div class="form-label">å°é¢åœ–ç‰‡</div>
          <label class="upload-box">
            é»æ“Šä¸Šå‚³ä¸€å¼µåœ–ç‰‡ä½œç‚ºå°é¢
            <input id="post-image" type="file" accept="image/*" />
            <div class="upload-preview">
              <img id="post-image-preview" alt="é è¦½åœ–ç‰‡" />
            </div>
          </label>
          <div class="helper-text">ç›®å‰ç‚ºå‰ç«¯ç¤ºç¯„ï¼Œåœ–ç‰‡å°‡ä»¥ base64 æš«å­˜åœ¨ç€è¦½å™¨è¨˜æ†¶é«”ä¸­ã€‚</div>
        </div>
        <button id="post-submit" class="btn-primary">ç™¼ä½ˆåˆ°å°å£è¢‹</button>
      </div>
    </section>

    <!-- é€šçŸ¥ -->
    <section id="page-notify" class="page">
      <div class="card">
        <div class="section-title">ç³»çµ±æé†’</div>
        <div class="empty-hint">
          ç›®å‰å°šæœªæ¥ä¸Šå¾Œç«¯ï¼Œé€™è£¡æš«æ™‚åªä½œç‚ºè¦–è¦ºå±•ç¤ºã€‚<br/>
          æœªä¾†å¯æ”¾å…¥ï¼šæœ‰äººæŒ‰è®šã€ç•™è¨€ã€è¿½è¹¤ä½ ã€å°å£è¢‹æ´»å‹•æ¨æ’­ç­‰ã€‚
        </div>
      </div>
    </section>

    <!-- æˆ‘çš„ -->
    <section id="page-profile" class="page">
      <div class="card">
        <div class="profile-header">
          <div class="profile-avatar">ğŸ‘¤</div>
          <div>
            <div class="profile-name">Demo ä½¿ç”¨è€…</div>
            <div class="profile-meta">æš«æ™‚ä½¿ç”¨å‡è³‡æ–™ Â· æœªæ¥æœƒå“¡ç³»çµ±</div>
            <div class="profile-stats">
              <div>
                <div class="stat-label">æˆ‘çš„ç­†è¨˜</div>
                <div class="stat-value" id="stat-post-count">0</div>
              </div>
              <div>
                <div class="stat-label">æ”¶è—</div>
                <div class="stat-value">0</div>
              </div>
              <div>
                <div class="stat-label">è¿½è¹¤ä¸­</div>
                <div class="stat-value">0</div>
              </div>
            </div>
          </div>
        </div>
        <div class="hint-banner">
          æœªä¾†å¯ä»¥åœ¨é€™è£¡æ¥ï¼šç™»å…¥/è¨»å†Šã€ç·¨è¼¯å€‹äººè³‡æ–™ã€ç®¡ç†è‰ç¨¿ã€è¨­å®šé€šçŸ¥åå¥½â€¦ç›®å‰åªå±•ç¤ºã€Œæˆ‘çš„ç­†è¨˜ã€åˆ—è¡¨ã€‚
        </div>
      </div>

      <div class="section-title">æˆ‘çš„ç­†è¨˜</div>
      <div id="my-post-list"></div>
      <div id="my-post-empty" class="empty-hint">å°šæœªç™¼ä½ˆä»»ä½•ç­†è¨˜ï¼Œå…ˆå»ã€Œï¼‹ç™¼ä½ˆã€åˆ†äº«ä¸€å‰‡å§ï¼</div>
    </section>
  </main>

  <!-- Bottom Tabs -->
  <nav class="tab-bar">
    <div class="tab-item active" data-target="home">
      <span class="icon">ğŸ </span>
      <span>é¦–é </span>
    </div>
    <div class="tab-item" data-target="discover">
      <span class="icon">ğŸ”</span>
      <span>æ¢ç´¢</span>
    </div>
    <div class="tab-item" data-target="post">
      <span class="icon">â•</span>
      <span>ç™¼ä½ˆ</span>
    </div>
    <div class="tab-item" data-target="notify">
      <span class="icon">ğŸ””</span>
      <span>é€šçŸ¥</span>
    </div>
    <div class="tab-item" data-target="profile">
      <span class="icon">ğŸ‘¤</span>
      <span>æˆ‘çš„</span>
    </div>
  </nav>
</div>

<script>
  // ===== Demo è³‡æ–™çµæ§‹ =====
  const demoPosts = [
    {
      id: "demo-1",
      user: "æµ·é‚Šæ•£æ­¥çš„äºº",
      avatar: "æµ·",
      title: "é€±æœ«ä¸€å€‹äººå»æµ·é‚Šæ•£æ•£å¿ƒ",
      content: "æ²’æœ‰ç‰¹åˆ¥çš„å®‰æ’ï¼Œå°±å¸¶è‘—è€³æ©Ÿã€ç›¸æ©Ÿå’Œä¸€æœ¬æ›¸ï¼Œæ²¿è‘—æµ·é‚Šæ…¢æ…¢èµ°ã€‚ç™¼ç¾å…¶å¯¦æ”¾ç©ºä¹Ÿæ˜¯ä¸€ç¨®å¾ˆé‡è¦çš„è¡Œç¨‹ã€‚",
      tags: ["æ—…éŠ", "ç”Ÿæ´»", "å¿ƒæƒ…"],
      image: "https://images.pexels.com/photos/2404370/pexels-photo-2404370.jpeg?auto=compress&cs=tinysrgb&w=800",
      likes: 23,
      comments: 5,
      time: "2 å°æ™‚å‰"
    },
    {
      id: "demo-2",
      user: "ä¸‹ç­æƒ³èººè‘—",
      avatar: "ç­",
      title: "æ‡¶äººä¹Ÿèƒ½åšçš„è¶…ç°¡å–®ä¸€é‹æ–™ç†",
      content: "ä¸‹ç­çœŸçš„ä¸æƒ³é–‹ç«å¤ªä¹…ï¼Œå°±æŠŠè”¬èœã€è‡é¡ã€é›è‚‰å…¨éƒ¨ä¸Ÿé€²é‹è£¡ï¼Œèª¿å‘³å¾Œä¸€èµ·ç…®ã€‚æ´—ç¢—ä¹Ÿåªè¦æ´—ä¸€é‹ï¼Œè¶…çˆ½ã€‚",
      tags: ["ç¾é£Ÿ", "æ‡¶äººæ–™ç†"],
      image: "https://images.pexels.com/photos/5718025/pexels-photo-5718025.jpeg?auto=compress&cs=tinysrgb&w=800",
      likes: 41,
      comments: 12,
      time: "æ˜¨å¤©"
    },
    {
      id: "demo-3",
      user: "è¡—å£ç©¿æ­æ§",
      avatar: "æ­",
      title: "ä»Šå¤©è©¦è‘—æ›äº†ä¸€ç¨®é¡è‰²çš„ç©¿æ­",
      content: "ä¸€ç›´éƒ½å¾ˆå®³æ€•ç©¿äº®è‰²ï¼Œä½†ä»Šå¤©ç¡¬è‘—é ­çš®è²·äº†ä¸€ä»¶äº®æ©˜è‰²å¤–å¥—ã€‚çµæœæ„å¤–çš„å¥½çœ‹ï¼Œèµ°åœ¨è·¯ä¸Šå¿ƒæƒ…éƒ½è®Šå¥½äº†ã€‚",
      tags: ["ç©¿æ­", "ç”Ÿæ´»"],
      image: "https://images.pexels.com/photos/7671166/pexels-photo-7671166.jpeg?auto=compress&cs=tinysrgb&w=800",
      likes: 67,
      comments: 19,
      time: "3 å¤©å‰"
    }
  ];

  let userPosts = []; // ä½¿ç”¨è€…è‡ªå·±ç™¼çš„
  let allPosts = [...demoPosts];

  // ===== DOM Reference =====
  const pages = {
    home: document.getElementById("page-home"),
    discover: document.getElementById("page-discover"),
    post: document.getElementById("page-post"),
    notify: document.getElementById("page-notify"),
    profile: document.getElementById("page-profile")
  };

  const tabItems = document.querySelectorAll(".tab-item");
  const feedList = document.getElementById("feed-list");
  const discoverList = document.getElementById("discover-list");
  const myPostList = document.getElementById("my-post-list");
  const myPostEmpty = document.getElementById("my-post-empty");
  const statPostCount = document.getElementById("stat-post-count");

  const postTitleInput = document.getElementById("post-title");
  const postContentInput = document.getElementById("post-content");
  const postTagsInput = document.getElementById("post-tags");
  const postImageInput = document.getElementById("post-image");
  const postImagePreview = document.getElementById("post-image-preview");
  const uploadPreviewWrapper = document.querySelector(".upload-preview");
  const postSubmitBtn = document.getElementById("post-submit");
  const searchInput = document.getElementById("search-input");

  // ===== Tab åˆ‡æ› =====
  function switchPage(target) {
    Object.values(pages).forEach(p => p.classList.remove("active"));
    tabItems.forEach(t => t.classList.remove("active"));

    const pageId = "page-" + target;
    const page = pages[target];
    if (page) page.classList.add("active");

    tabItems.forEach(t => {
      if (t.dataset.target === target) {
        t.classList.add("active");
      }
    });

    if (target === "home") {
      renderFeed(allPosts);
    } else if (target === "discover") {
      renderDiscover(allPosts);
    } else if (target === "profile") {
      renderMyPosts();
    }
  }

  tabItems.forEach(tab => {
    tab.addEventListener("click", () => {
      const target = tab.dataset.target;
      switchPage(target);
    });
  });

  // ===== æ¸²æŸ“è²¼æ–‡å¡ç‰‡ =====
  function createPostCard(post) {
    const card = document.createElement("div");
    card.className = "card";

    const tagsHtml = (post.tags || [])
      .map(tag => `<span class="tag"># ${tag}</span>`)
      .join("");

    const imageHtml = post.image
      ? `<div class="post-image"><img src="${post.image}" alt="post image" loading="lazy"></div>`
      : "";

    card.innerHTML = `
      <div class="post-header">
        <div class="avatar">${(post.avatar || "å£").slice(0, 1)}</div>
        <div>
          <div class="post-user">${post.user || "å°å£è¢‹ç”¨æˆ¶"}</div>
          <div class="post-meta">${post.time || "å‰›å‰› Â· ä¾†è‡ª å°å£è¢‹ Demo"}</div>
        </div>
      </div>
      <div class="post-title">${post.title || "æœªå‘½åæ¨™é¡Œ"}</div>
      <div class="post-text">${post.content || ""}</div>
      ${imageHtml}
      <div class="post-tags">${tagsHtml}</div>
      <div class="post-actions">
        <div class="post-actions-left">
          <div class="icon-btn">â¤ï¸ <span>${post.likes ?? 0}</span></div>
          <div class="icon-btn">ğŸ’¬ <span>${post.comments ?? 0}</span></div>
        </div>
        <div class="post-actions-right">
          <div class="icon-btn">â‹¯</div>
        </div>
      </div>
    `;
    return card;
  }

  function renderFeed(posts) {
    feedList.innerHTML = "";
    if (!posts.length) {
      const empty = document.createElement("div");
      empty.className = "empty-hint";
      empty.innerHTML = "ç›®å‰é‚„æ²’æœ‰å…§å®¹ï¼Œå…ˆå»ã€Œï¼‹ç™¼ä½ˆã€åˆ†äº«ç¬¬ä¸€å‰‡å°å£è¢‹ç­†è¨˜å§ï¼";
      feedList.appendChild(empty);
      return;
    }
    posts.forEach(p => {
      const card = createPostCard(p);
      feedList.appendChild(card);
    });
  }

  function renderDiscover(posts) {
    discoverList.innerHTML = "";
    if (!posts.length) {
      const empty = document.createElement("div");
      empty.className = "empty-hint";
      empty.innerHTML = "æš«æ™‚æ²’æœ‰æ‰¾åˆ°ç›¸é—œå…§å®¹ï¼Œå¯ä»¥è©¦è©¦å…¶ä»–é—œéµå­—æˆ–æ¨™ç±¤ã€‚";
      discoverList.appendChild(empty);
      return;
    }
    posts.forEach(p => {
      const card = createPostCard(p);
      discoverList.appendChild(card);
    });
  }

  function renderMyPosts() {
    myPostList.innerHTML = "";
    if (!userPosts.length) {
      myPostEmpty.style.display = "block";
    } else {
      myPostEmpty.style.display = "none";
      userPosts.slice().reverse().forEach(p => {
        const card = createPostCard(p);
        myPostList.appendChild(card);
      });
    }
    statPostCount.textContent = userPosts.length.toString();
  }

  // ===== åœ–ç‰‡é è¦½ =====
  let selectedImageDataUrl = "";
  postImageInput.addEventListener("change", function (e) {
    const file = e.target.files && e.target.files[0];
    if (!file) {
      selectedImageDataUrl = "";
      uploadPreviewWrapper.style.display = "none";
      postImagePreview.src = "";
      return;
    }
    const reader = new FileReader();
    reader.onload = function (evt) {
      selectedImageDataUrl = evt.target.result;
      postImagePreview.src = selectedImageDataUrl;
      uploadPreviewWrapper.style.display = "block";
    };
    reader.readAsDataURL(file);
  });

  // ===== ç™¼ä½ˆè²¼æ–‡ =====
  postSubmitBtn.addEventListener("click", function () {
    const title = postTitleInput.value.trim();
    const content = postContentInput.value.trim();
    const rawTags = postTagsInput.value.trim();

    if (!title && !content) {
      alert("è‡³å°‘è¼¸å…¥æ¨™é¡Œæˆ–å…§å®¹å†ç™¼ä½ˆå–”ã€‚");
      return;
    }

    const tags = rawTags
      ? rawTags.split(",").map(t => t.trim()).filter(Boolean)
      : [];

    const newPost = {
      id: "user-" + Date.now(),
      user: "Demo ä½¿ç”¨è€…",
      avatar: "D",
      title: title || "æœªå‘½åæ¨™é¡Œ",
      content,
      tags,
      image: selectedImageDataUrl || "",
      likes: 0,
      comments: 0,
      time: "å‰›å‰›"
    };

    userPosts.push(newPost);
    allPosts.unshift(newPost);

    postTitleInput.value = "";
    postContentInput.value = "";
    postTagsInput.value = "";
    postImageInput.value = "";
    selectedImageDataUrl = "";
    uploadPreviewWrapper.style.display = "none";

    alert("å·²ç™¼ä½ˆåˆ°å°å£è¢‹ï¼ˆåƒ…æœ¬æ©Ÿ Demoï¼‰");

    renderFeed(allPosts);
    renderMyPosts();
    switchPage("home");
  });

  // ===== æ¢ç´¢æœå°‹ =====
  function filterPostsByKeyword(keyword) {
    if (!keyword) return allPosts;
    const lower = keyword.toLowerCase();
    return allPosts.filter(p => {
      const text = (p.title + " " + p.content + " " + (p.tags || []).join(" ")).toLowerCase();
      return text.includes(lower);
    });
  }

  searchInput.addEventListener("input", function (e) {
    const keyword = e.target.value.trim();
    const result = filterPostsByKeyword(keyword);
    renderDiscover(result);
  });

  // Tag chips é»æ“Šæœå°‹
  document.querySelectorAll(".chip").forEach(chip => {
    chip.addEventListener("click", () => {
      const tag = chip.dataset.tag;
      searchInput.value = tag;
      const result = filterPostsByKeyword(tag);
      renderDiscover(result);
    });
  });

  // ===== åˆå§‹åŒ– =====
  renderFeed(allPosts);
  renderDiscover(allPosts);
</script>
</body>
</html>
